<!DOCTYPE html>
<html>
<head>
<title>Scan Barcode KM</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial; padding: 20px; }
video { width: 100%; border: 2px solid #333; border-radius: 12px; }
#result { margin-top: 20px; font-size: 20px; }
</style>
</head>

<body>
<h2>üì∏ Qu√©t m√£ Barcode</h2>

<div id="scanner-container"></div>
<div id="result"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
<script>
function startScanner() {
    Quagga.init({
        inputStream: {
            name: "Live",
            type: "LiveStream",
            target: document.querySelector("#scanner-container"),
            constraints: { facingMode: "environment" }
        },
        decoder: { readers: ["ean_reader"] }
    }, function(err) {
        if (err) { console.error(err); return; }
        Quagga.start();
    });

    Quagga.onDetected(async function(data) {
        let code = data.codeResult.code;
        document.getElementById("result").innerHTML = "ƒêang g·ª≠i m√£: " + code;

        let api = "http://10.145.1.79:5000/scan";

        let res = await fetch(api, {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({code})
        });

        let json = await res.json();
        document.getElementById("result").innerHTML =
            "<pre>" + JSON.stringify(json, null, 2) + "</pre>";
    });
}

startScanner();
</script>
</body>
</html>
