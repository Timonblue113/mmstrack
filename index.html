<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>QuÃ©t Barcode â†’ Tra SKU</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>

    <style>
        body { font-family: Arial; text-align: center; padding: 20px; }
        #video { width: 90%; margin: 20px auto; border: 2px solid #000; }
        .result { font-size: 22px; margin-top: 15px; }
    </style>
</head>

<body>

<h2>ðŸ“± QUÃ‰T MÃƒ BARCODE / MÃƒ 13</h2>
<div id="video"></div>

<button onclick="startScanner()">Báº¯t Ä‘áº§u quÃ©t</button>

<div class="result" id="result"></div>

<script>
    function startScanner() {
        Quagga.init({
            inputStream: {
                name: "Live",
                type: "LiveStream",
                target: document.querySelector('#video')
            },
            decoder: {
                readers: ["ean_reader", "ean_13_reader", "code_128_reader"]
            }
        }, function(err) {
            if (err) {
                console.log(err);
                return;
            }
            Quagga.start();
        });

        Quagga.onDetected(function(data) {
            let code = data.codeResult.code;
            document.getElementById("result").innerHTML = "ÄÃ£ quÃ©t: " + code;
            Quagga.stop();

            // Gá»­i lÃªn server Flask
            fetch("http://113.161.166.216:5000/api/scan", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ code: code })
            })
            .then(res => res.json())
            .then(json => {
                document.getElementById("result").innerHTML =
                    "MÃ£ quÃ©t: " + json.input + "<br>" +
                    "âž¡ SKU láº¥y Ä‘Æ°á»£c: <b>" + json.sku + "</b>";
            });
        });
    }
</script>

</body>
</html>
